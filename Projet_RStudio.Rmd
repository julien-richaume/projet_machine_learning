---
title: "Projet"
output: html_document
date: "2024-02-16"
---

##**Analyse exploratoire de données**

```{r}
install.packages("factoextra")
```

```{r}
library(ggplot2)
library(tidyverse)
library(gridExtra)
library(GGally)
library(plotly)
library(corrplot)
library(reshape2)
library(FactoMineR)
library(factoextra)
library(glmnet) 
library(ggfortify)
library(pROC)
library(ROCR)
library(dplyr)
```

Lecture des données

```{r setup, include=FALSE}

# path="http://www.math.univ-toulouse.fr/~besse/Wikistat/data/"
path <- ""
df <- read.csv(paste(path, "global-data-on-sustainable-energy (1).csv", sep = ""),
                    sep = ",", dec="." ,header = TRUE)
# Premières lignes du jeu de données
head(df)
# Vérification du contenu
summary(df)
# Vérification de la dimension
#view(df)
```
# 1. Transformation des variables "Year" et "Density.P.Km2"

```{r}
df[,"Year"] <- as.factor(df[,"Year"])
df[,"Density.P.Km2."] <- as.numeric(gsub(",",".",(df[,"Density.P.Km2."])))

summary(df["Density.P.Km2."])
#summary(df["Year"])
view(df)
```

# 2. Taux de valeurs manquantes pour chaque variable

```{r}
for (i in names(df))
  print(paste(sum(is.na(df[i])/nrow(df)*100) ,":", i))
```
On retire les variables qui ont un taux de valeurs manquantes trop important

```{r}
new_df <- subset(df, select = -c(Renewable.electricity.generating.capacity.per.capita, Financial.flows.to.developing.countries..US..., Renewables....equivalent.primary.energy.))
nrow(new_df)
```
# 3. Création d'un dataframe contenant les variables qui n'ont pas de valeurs manquantes

```{r}
df2 <- na.omit(new_df)
nrow(df2)
```

```{r}
summary(df2)
```

# 4. Analyse descriptive unidimentionnelle
```{r}
library(ggplot2)
library(gridExtra)

g1<-ggplot(df2,aes(x=Access.to.electricity....of.population.))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue") 
g2<-ggplot(df2,aes(x=Access.to.clean.fuels.for.cooking))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue") 
g3<-ggplot(df2,aes(x=as.integer(Renewable.energy.share.in.the.total.final.energy.consumption....)))+geom_histogram(aes(y=after_stat(density)), binwidth=10)+geom_density(alpha=.2, col="blue") 
g4<-ggplot(df2,aes(x=as.integer(Electricity.from.fossil.fuels..TWh.)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g5<-ggplot(df2,aes(x=as.integer(Electricity.from.nuclear..TWh.)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g6<-ggplot(df2,aes(x=as.integer(Electricity.from.renewables..TWh.)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g7<-ggplot(df2,aes(x=as.integer(Low.carbon.electricity....electricity.)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g8<-ggplot(df2,aes(x=as.integer(Primary.energy.consumption.per.capita..kWh.person.)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g9<-ggplot(df2,aes(x=as.integer(Energy.intensity.level.of.primary.energy..MJ..2017.PPP.GDP.)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g10<-ggplot(df2,aes(x=as.integer(Value_co2_emissions_kt_by_country)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g11<-ggplot(df2,aes(x=as.integer(gdp_growth)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g12<-ggplot(df2,aes(x=as.integer(gdp_per_capita)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g13<-ggplot(df2,aes(x=as.integer(Density.P.Km2.)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 
g14<-ggplot(df2,aes(x=as.integer(Land.Area.Km2.)))+geom_histogram(aes(y=after_stat(density)))+geom_density(alpha=.2, col="blue") 

grid.arrange(g1,g2, g3,g4,ncol=2)
grid.arrange(g5,g6,g7,g8,ncol=2)
grid.arrange(g9, g10, g11, g12, g13, g14, ncol=2)
rm(g1,g2,g3,g4,g5,g6,g7,g8)
```

Transformations possibles : - Quantitative en qualitative (Year) - Quantitative en Qualitative (à l'aide d'un seuil) - Transformation de var quantitative : log(), sqrt(),

```{r}
b1<-ggplot(df2,aes(x=Access.to.electricity....of.population.))+
  geom_boxplot()
b2<-ggplot(df2,aes(x=Access.to.clean.fuels.for.cooking))+
  geom_boxplot()
b3<-ggplot(df2,aes(x=as.integer(Renewable.energy.share.in.the.total.final.energy.consumption....)))+geom_boxplot()
b4<-ggplot(df2,aes(x=as.integer(Electricity.from.fossil.fuels..TWh.)))+geom_boxplot()
b5<-ggplot(df2,aes(x=as.integer(Electricity.from.nuclear..TWh.)))+geom_boxplot()
b6<-ggplot(df2,aes(x=as.integer(Electricity.from.renewables..TWh.)))+geom_boxplot()
b7<-ggplot(df2,aes(x=as.integer(Low.carbon.electricity....electricity.)))+geom_boxplot()
b8<-ggplot(df2,aes(x=as.integer(Primary.energy.consumption.per.capita..kWh.person.)))+geom_boxplot()
b9<-ggplot(df2,aes(x=as.integer(Energy.intensity.level.of.primary.energy..MJ..2017.PPP.GDP.)))+geom_boxplot()
b10<-ggplot(df2,aes(x=as.integer(Value_co2_emissions_kt_by_country)))+geom_boxplot()
b11<-ggplot(df2,aes(x=as.integer(gdp_growth)))+geom_histogram(aes(y=after_stat(density)))+geom_boxplot()
b12<-ggplot(df2,aes(x=as.integer(gdp_per_capita)))+geom_histogram(aes(y=after_stat(density)))+geom_boxplot()
b13<-ggplot(df2,aes(x=as.integer(Density.P.Km2.)))+geom_histogram(aes(y=after_stat(density)))+geom_boxplot()
b14<-ggplot(df2,aes(x=as.integer(Land.Area.Km2.)))+geom_histogram(aes(y=after_stat(density)))+geom_boxplot()
  
grid.arrange(b1,b2, b3,b4,ncol=2)
grid.arrange(b5,b6,b7,b8,ncol=2)
grid.arrange(b9, b10, b11, b12, b13, b14, ncol=2)
rm(b1,b2,b3,b4,b5,b6,b7,b8)



```


Transformations adéquates des variables

```{r}
#Le graphe précedent n'était pas explicite donc on utilise le log pour visualiser des var qui ont des ordres de grandeurs différents. A la fin, regarder si les transformations ont été pertinentes : comparer les résultats avec les deux df (df2 et df3).
#On va vouloir ici réaliser des transformations de variables avec la fonction log. Cependant, log(0) renvoie -Inf, donc on doit adapter les données pour pouvoir les visualiser correctement. Vérifions déjà quelles données possèdent des 0.
sum(df$Value_co2_emissions_kt_by_country==0, na.rm=TRUE)
sum(df$Electricity.from.nuclear..TWh.==0, na.rm=TRUE)  #3000 variables nulles pour le nucléaire, cette variable ne peut pas être transformée avec log
sum(df$Electricity.from.renewables..TWh.==0, na.rm=TRUE)
sum(df$Electricity.from.fossil.fuels..TWh.==0, na.rm=TRUE)
summary(df$Electricity.from.nuclear..TWh.==0)
```

```{r}
eps = 0.1 #On utilise eps pour décaler les valeurs, et ainsi éviter de faire log(0)=-Inf...

df2 <- df2 %>% mutate(Nuclear_log = log(Electricity.from.nuclear..TWh. + eps),
                      Renewables_log = log(Electricity.from.renewables..TWh. + eps),
                      Fossil_fuels_log = log(Electricity.from.fossil.fuels..TWh. + eps))

df2 <- df2 %>% mutate(Value_co2_log = log(Value_co2_emissions_kt_by_country), #Aucun 0 pour cette variable, la transfo log est pertinente et utile.
                      Primary_energy_consumption_log = log(Primary.energy.consumption.per.capita..kWh.person.),
                      Renewable_energy_share_log = log(Renewable.energy.share.in.the.total.final.energy.consumption....),
                      .keep = "unused")

# On garde Low.carbon.electricity, Access_to_electricity, Access_to_clean_fuels, gdp_growth comme telles.
  
df3 <- df2

g2<-ggplot(df3,aes(x=Value_co2_log))+
  geom_histogram(aes(y=after_stat(density)), binwidth=1)+
  geom_density(alpha=.2, col="blue")

g4<-ggplot(df3,aes(x=Fossil_fuels_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

g5<-ggplot(df3,aes(x=Nuclear_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

g6<-ggplot(df3,aes(x=Renewables_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

g7<-ggplot(df3,aes(x=Primary_energy_consumption_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

g8<-ggplot(df3,aes(x=Renewable_energy_share_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

grid.arrange(g2,g4,g5,g6,g7,g8,ncol=2)

df3$Year <- as.factor(df3$Year)

df3 <- subset(df3, select = -c(Nuclear_log, Renewables_log, Fossil_fuels_log)) #pb de valeurs nulles, ne fonctionne pas bien avec la transfo log !
```

```{r}
grid.arrange(g2,g4,g5,g6,ncol=2)
```

```{r}
df3 <- df3 %>% mutate(Energy_intensity_level_log = log(Energy.intensity.level.of.primary.energy..MJ..2017.PPP.GDP.))

g1<-ggplot(df3,aes(x=Energy.intensity.level.of.primary.energy..MJ..2017.PPP.GDP.))+
  geom_histogram(aes(y=after_stat(density)), binwidth=1)+
  geom_density(alpha=.2, col="blue")

g8<-ggplot(df3,aes(x=Energy_intensity_level_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

grid.arrange(g1, g8, ncol = 2)

df3 <- subset(df3, select = -c(Energy.intensity.level.of.primary.energy..MJ..2017.PPP.GDP.))
```

```{r}
df3 <- df3 %>% mutate(Density_log = log(Density.P.Km2.))

g1<-ggplot(df3,aes(x=Density.P.Km2.))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

g8<-ggplot(df3,aes(x=Density_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

grid.arrange(g1, g8, ncol = 2)

df3 <- subset(df3, select = -c(Density.P.Km2.))
```

```{r}
df3 <- df3 %>% mutate(Land_Area_log = log(Land.Area.Km2.))

g1<-ggplot(df3,aes(x=Land.Area.Km2.))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

g8<-ggplot(df3,aes(x=Land_Area_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

grid.arrange(g1, g8, ncol = 2)

df3 <- subset(df3, select = -c(Land.Area.Km2.))
```


```{r}
df3 <- df3 %>% mutate(gdp_per_capita_log = log(gdp_per_capita))

g1<-ggplot(df3,aes(x=gdp_per_capita))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

g8<-ggplot(df3,aes(x=gdp_per_capita_log))+
  geom_histogram(aes(y=after_stat(density)))+
  geom_density(alpha=.2, col="blue")

grid.arrange(g1, g8, ncol = 2)

df3 <- subset(df3, select = -c(gdp_per_capita))
```


```{r}
summary(df3)
```

# 5. Emissions de C02 par les différents pays

```{r, echo=FALSE}
library(tidyverse)

pays_pollueurs<- df3 %>% arrange(desc(Value_co2_log)) %>% ## on classe par ordre décroissant
select(Entity,Value_co2_log) ## on sélectionne les 2 colonnes

## Les 5 pays les plus pollueurs
pays_pollueurs <- distinct(pays_pollueurs,Entity)
pays_pollueurs <- pays_pollueurs %>% slice(1:5)
print(pays_pollueurs)
```

# 6. Analyse multidimentionnelle

```{r}
summary(df3)
```

Nuage de points

```{r}
ggplot(data.frame(x=df3$Electricity.from.renewables..TWh., y=df3$Value_co2_log),aes(x,y))+
geom_point(col='blue')
```


```{r}
ggplot(data.frame(x=df3$Electricity.from.renewables..TWh., y=df3$Value_co2_log),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre utilisation d'énergie renouvelables et émissions de CO2")
ggplot(data.frame(x=df3$Electricity.from.nuclear..TWh., y=df3$Value_co2_log),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre utilisation d'énergie nucléaire et émissions de CO2")
ggplot(data.frame(x=df3$Electricity.from.fossil.fuels..TWh., y=df3$Value_co2_log),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre utilisation d'énergie fossile et les émissions de CO2")
```


```{r}
ggplot(data.frame(x=df3$Electricity.from.nuclear..TWh., y=df3$gdp_per_capita),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre utilisation d'énergie nucléaire et le PIB par habitant")
ggplot(data.frame(x=df3$Electricity.from.renewables..TWh., y=df3$gdp_per_capita),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre utilisation d'énergies renouvelables et le PIB par habitant")
ggplot(data.frame(x=df3$Electricity.from.fossil.fuels..TWh., y=df3$gdp_per_capita),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre utilisation d'énergies non renouvelables et le PIB par habitant")
```

```{r}
summary(df3)
```


```{r}
ggplot(data.frame(x=df3$Primary_energy_consumption_log, y=df3$Access.to.electricity....of.population.),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre l'accès à l'electricité et la consommation d'énergie")
ggplot(data.frame(x=df3$Primary_energy_consumption_log, y=df3$Access.to.clean.fuels.for.cooking),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre l'accès au carburant propre pour la cuisine et la consommation d'énergie")
```


```{r}
ggplot(data.frame(x=df3$Electricity.from.fossil.fuels..TWh., y=df3$Low.carbon.electricity....electricity.),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre prod énergies non renouvelables et à faible emission carbone  ")
```

```{r}
ggplot(data.frame(x=df3$Value_co2_log, y=df3$Primary_energy_consumption_log),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre émission CO2 et conso d'énergies primaires ")
```

```{r}
ggplot(data.frame(x=df3$Value_co2_log, y=df3$Renewable_energy_share_log),aes(x,y))+
geom_point(col='blue')+ggtitle("Relation entre émission CO2 et conso d'énergies renouvelables  ")
```


```{r}
cor.test(df3$Electricity.from.nuclear..TWh., df3$Value_co2_log)
```

```{r}
ggplot(data.frame(x=df3$Year, y=df3$Primary_energy_consumption_log),aes(x,y))+
geom_point(col='blue')
```

Graphe de corrélations

```{r}
corrplot(cor(df3[, c(3:19)]), 
         method = "ellipse", 
         tl.cex = 0.4)
```

```{r}
ggplot(data.frame(x=df3$Access.to.electricity....of.population., y=df3$Renewable_energy_share_log),aes(x,y))+
```

```{r}
ggpairs(df3[, c(3:19)])
```

```{r}
geom_point(col='blue')
```

# 7. Analyse en composante principale

```{r}
# Normalisation des données
df_norm <- scale(df2[, c(3:19)])
```


```{r}
## ACP
df_PCA <- PCA(df_norm)
print(df_PCA)
```

```{r}
summary(df_PCA)  
```


Combien faut-il garder de composantes pour expliquer au mieux nos données ?

```{r}
df_PCA$eig
```

```{r}
options(repr.plot.width = 9, repr.plot.height = 6)

fviz_pca(df_PCA, axes=c(1,2), geom = c("point"), col.ind="grey")
fviz_pca(df_PCA, axes=c(1,3), geom = c("point"), col.ind="grey")
fviz_pca(df_PCA, axes=c(2,3), geom = c("point"), col.ind="grey")
```
Qualité de représentation des variables : plus le résultat est proche de 1 mieux c'est

```{r}
df_PCA$var$cos2
```
Contribution des variables aux axes : plus la valeur est grande plus la variable contribue à l'axe

```{r}
df_PCA$var$contrib
```

# 8. Dépendance entre "Year" et  "Value-co2-emissions"

```{r}
# violin plot
 ggplot(data.frame(x=df2$Year, y=df2$Value_co2_log),aes(x,y)) + 
  geom_violin()

# diagramme en boite
boxplot(df2$Value_co2_log~ df2$Year , data = df2)
```

